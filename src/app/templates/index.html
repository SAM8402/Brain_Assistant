<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Region Assistant</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>Brain Region Assistant</h1>
            <p>Click on any brain region to explore with AI assistance</p>
        </header>

        <div class="main-content">
            <!-- Brain Atlas Section -->
            <div class="brain-section full-width">
                <div class="brain-atlas-container">
                    <h2>Sagittal Brain Section</h2>
                    
                    <!-- SVG Brain Atlas matching the reference image -->
                    <svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg" class="brain-atlas-svg">
                        <!-- Background -->
                        <rect width="800" height="600" fill="#f5f5f5"/>
                        
                        <!-- Brain Outline -->
                        <path d="M 200 150 Q 250 50, 400 50 Q 550 50, 600 150 Q 650 250, 600 400 Q 550 500, 400 520 Q 250 500, 150 400 Q 100 300, 150 200 Q 175 150, 200 150" 
                              fill="#f0f0f0" stroke="#333" stroke-width="2"/>
                        
                        <!-- Corpus Callosum (white curved structure) -->
                        <g class="brain-region" data-region="corpus callosum">
                            <path d="M 250 200 Q 300 150, 400 150 Q 500 150, 550 200 L 540 210 Q 490 170, 400 170 Q 310 170, 260 210 Z" 
                                  fill="#ffffff" stroke="#333" stroke-width="2" opacity="0.9"/>
                            <text x="400" y="185" text-anchor="middle" class="region-label">Corpus Callosum</text>
                        </g>
                        
                        <!-- Frontal Lobe -->
                        <g class="brain-region" data-region="frontal lobe">
                            <path d="M 200 150 Q 250 100, 350 120 L 360 250 Q 300 260, 250 250 L 200 200 Z" 
                                  fill="#d8b2d8" stroke="#333" stroke-width="2" opacity="0.7"/>
                            <text x="280" y="180" text-anchor="middle" class="region-label">Frontal Lobe</text>
                        </g>
                        
                        <!-- Prefrontal Cortex -->
                        <g class="brain-region" data-region="prefrontal cortex">
                            <path d="M 200 150 Q 220 120, 260 130 L 265 180 L 220 175 Z" 
                                  fill="#c8a2c8" stroke="#333" stroke-width="2" opacity="0.7"/>
                        </g>
                        
                        <!-- Parietal Lobe -->
                        <g class="brain-region" data-region="parietal lobe">
                            <path d="M 360 120 Q 450 100, 520 150 L 510 250 Q 450 260, 360 250 Z" 
                                  fill="#87ceeb" stroke="#333" stroke-width="2" opacity="0.7"/>
                            <text x="440" y="180" text-anchor="middle" class="region-label">Parietal Lobe</text>
                        </g>
                        
                        <!-- Occipital Lobe -->
                        <g class="brain-region" data-region="occipital lobe">
                            <path d="M 520 150 Q 580 180, 600 250 L 580 320 Q 540 300, 510 250 Z" 
                                  fill="#ffd700" stroke="#333" stroke-width="2" opacity="0.7"/>
                            <text x="550" y="240" text-anchor="middle" class="region-label">Occipital Lobe</text>
                        </g>
                        
                        <!-- Temporal Lobe -->
                        <g class="brain-region" data-region="temporal lobe">
                            <path d="M 250 250 Q 200 280, 180 350 Q 200 400, 280 420 L 350 380 L 360 320 Q 320 280, 250 250 Z" 
                                  fill="#98fb98" stroke="#333" stroke-width="2" opacity="0.7"/>
                            <text x="270" y="350" text-anchor="middle" class="region-label">Temporal Lobe</text>
                        </g>
                        
                        <!-- Cerebellum -->
                        <g class="brain-region" data-region="cerebellum">
                            <path d="M 480 380 Q 520 360, 580 380 Q 600 420, 570 460 Q 520 480, 470 460 Q 450 420, 480 380 Z" 
                                  fill="#dda0dd" stroke="#333" stroke-width="2" opacity="0.8"/>
                            <text x="525" y="420" text-anchor="middle" class="region-label">Cerebellum</text>
                        </g>
                        
                        <!-- Brainstem -->
                        <g class="brain-region" data-region="brainstem">
                            <rect x="380" y="400" width="60" height="100" rx="20" 
                                  fill="#f4a460" stroke="#333" stroke-width="2" opacity="0.7"/>
                            <text x="410" y="455" text-anchor="middle" class="region-label small">Brainstem</text>
                        </g>
                        
                        <!-- Midbrain -->
                        <g class="brain-region" data-region="midbrain">
                            <ellipse cx="410" cy="380" rx="30" ry="20" 
                                     fill="#ff9999" stroke="#333" stroke-width="2" opacity="0.7"/>
                            <text x="410" y="385" text-anchor="middle" class="region-label small">Midbrain</text>
                        </g>
                        
                        <!-- Pons -->
                        <g class="brain-region" data-region="pons">
                            <ellipse cx="410" cy="420" rx="35" ry="25" 
                                     fill="#ffb366" stroke="#333" stroke-width="2" opacity="0.7"/>
                            <text x="410" y="425" text-anchor="middle" class="region-label small">Pons</text>
                        </g>
                        
                        <!-- Medulla -->
                        <g class="brain-region" data-region="medulla oblongata">
                            <ellipse cx="410" cy="470" rx="30" ry="25" 
                                     fill="#ff8566" stroke="#333" stroke-width="2" opacity="0.7"/>
                            <text x="410" y="475" text-anchor="middle" class="region-label small">Medulla</text>
                        </g>
                        
                        <!-- Thalamus -->
                        <g class="brain-region" data-region="thalamus">
                            <ellipse cx="400" cy="280" rx="40" ry="30" 
                                     fill="#ff6b6b" stroke="#333" stroke-width="2" opacity="0.7"/>
                            <text x="400" y="285" text-anchor="middle" class="region-label small">Thalamus</text>
                        </g>
                        
                        <!-- Hypothalamus -->
                        <g class="brain-region" data-region="hypothalamus">
                            <ellipse cx="400" cy="320" rx="25" ry="15" 
                                     fill="#cc5555" stroke="#333" stroke-width="2" opacity="0.7"/>
                            <text x="400" y="325" text-anchor="middle" class="region-label small">Hypothalamus</text>
                        </g>
                        
                        <!-- Hippocampus -->
                        <g class="brain-region" data-region="hippocampus">
                            <path d="M 340 340 Q 360 330, 380 340 Q 390 360, 370 370 Q 350 360, 340 340 Z" 
                                  fill="#ffe066" stroke="#333" stroke-width="2" opacity="0.8"/>
                            <text x="360" y="375" text-anchor="middle" class="region-label small">Hippocampus</text>
                        </g>
                        
                        <!-- Amygdala -->
                        <g class="brain-region" data-region="amygdala">
                            <circle cx="320" cy="360" r="15" 
                                    fill="#ff99cc" stroke="#333" stroke-width="2" opacity="0.8"/>
                            <text x="320" y="385" text-anchor="middle" class="region-label small">Amygdala</text>
                        </g>
                        
                        <!-- Pituitary Gland -->
                        <g class="brain-region" data-region="pituitary gland">
                            <circle cx="400" cy="350" r="10" 
                                    fill="#ffcc00" stroke="#333" stroke-width="2" opacity="0.8"/>
                            <text x="400" y="370" text-anchor="middle" class="region-label small">Pituitary</text>
                        </g>
                        
                        <!-- Pineal Gland -->
                        <g class="brain-region" data-region="pineal gland">
                            <circle cx="450" cy="280" r="8" 
                                    fill="#ffaa00" stroke="#333" stroke-width="2" opacity="0.8"/>
                            <text x="485" y="285" text-anchor="middle" class="region-label small">Pineal</text>
                        </g>
                        
                        <!-- Cingulate Gyrus -->
                        <g class="brain-region" data-region="cingulate gyrus">
                            <path d="M 280 210 Q 350 190, 450 210" 
                                  stroke="#90ee90" stroke-width="8" fill="none" opacity="0.7"/>
                            <text x="365" y="205" text-anchor="middle" class="region-label small">Cingulate Gyrus</text>
                        </g>
                        
                        <!-- Fornix -->
                        <g class="brain-region" data-region="fornix">
                            <path d="M 320 250 Q 380 230, 440 250" 
                                  stroke="#dcdcdc" stroke-width="6" fill="none" opacity="0.7"/>
                        </g>
                    </svg>
                </div>
                
                <!-- Custom Region Input -->
                <div class="custom-region-input">
                    <h3>Or search for a specific brain region:</h3>
                    <div class="search-container">
                        <input type="text" id="customRegion" placeholder="e.g., motor cortex, broca's area, substantia nigra">
                        <button id="searchBtn">Explore Region</button>
                    </div>
                </div>
            </div>

            <!-- Chatbot Section (Initially Hidden) -->
            <div class="chatbot-section" id="chatbotSection" style="display: none;">
                <div class="chat-container">
                    <div class="chat-header">
                        <h2>Brain AI Assistant</h2>
                        <span id="currentRegion"></span>
                        <div class="chat-controls">
                            <button class="history-btn" id="historyBtn" title="View Chat History">📜</button>
                            <button class="clear-btn" id="clearBtn" title="Clear Chat History">🗑️</button>
                            <button class="close-chat" id="closeChat">×</button>
                        </div>
                    </div>
                    
                    <div class="chat-messages" id="chatMessages">
                        <!-- Messages will be added dynamically -->
                    </div>
                    
                    <div class="chat-input-container">
                        <div class="mode-selector">
                            <label>
                                <input type="radio" name="mode" value="fast" checked> Fast
                            </label>
                            <label>
                                <input type="radio" name="mode" value="web"> Detailed (Web)
                            </label>
                            <label>
                                <input type="radio" name="mode" value="ultra"> Ultra-fast
                            </label>
                        </div>
                        
                        <div class="chat-input">
                            <input type="text" id="questionInput" placeholder="Ask a question about the selected brain region...">
                            <button id="askBtn" disabled>Ask</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat History Modal -->
    <div class="modal" id="historyModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Chat History</h3>
                <span class="close-modal" id="closeHistoryModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="history-stats">
                    <span id="historyStats">Loading...</span>
                </div>
                <div class="history-list" id="historyList">
                    <!-- History items will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="downloadHistory">Download History</button>
                <button class="btn-primary" id="closeHistoryBtn">Close</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>